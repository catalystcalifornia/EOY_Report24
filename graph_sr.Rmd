---
title: ""
output:
  html_document:
    css: "W:\\Project\\Communications\\EOY_Report24\\styles\\eoy_charts.css"
---
<!-- link to Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

```{r setup, include=FALSE}
#### Set up workspace ####
library(dplyr)
library(highcharter)

knitr::opts_chunk$set(echo = FALSE)

# set global options to ensure that comma separator is a comma for highchart graphs
lang <- getOption("highcharter.lang")
lang$thousandsSep <- ","
options(highcharter.lang = lang)

```

```{r themes, include=FALSE}
#### Set themes and options ####
## COLORS ##
meteorite <- "#3A207D"
lavender <- "#D6CADD"
black <- "#000000"
alabaster<-"#FBFBFB"
white <- "#FFFFFF"
gainsboro <- "#2B2B2B"

# define fonts in chart
main_font <- "Inter"
black_font_weight <- 900
regular_font_weight <- 400

# set theme 
#(Theme colors Developed from online color generator based on meteorite https://mycolor.space/?hex=%233A207D&sub=1)
eoy_colors <- c(meteorite, "#991F7B", "#D8406A", "#FC7957","#FFB951", "#FFEEAC", lavender)
eoy_theme <- hc_theme(colors = eoy_colors,
                     chart = list(backgroundColor = alabaster,
                                  style = list(fontFamily = main_font, 
                                               fontWeight = black_font_weight,
                                               color=white)),
                     title = list(align="center",
                                  style = list(color = black,
                                               fontFamily = main_font, 
                                               fontWeight = black_font_weight,
                                               fontSize='25px'),
                                  useHTML = TRUE),
                     subtitle = list(align="left",
                                     style = list(color = black,
                                                  fontFamily = main_font, 
                                                  fontWeight = black_font_weight,
                                                  fontSize='20px'),
                                     useHTML = TRUE),
                     caption = list(align="center",
                                    style = list(color = meteorite,
                                                 fontFamily = main_font, 
                                                 fontWeight = black_font_weight,
                                                 fontSize="22px"),
                                    useHTML = TRUE),
             
                     axis = list(style = list(color = gainsboro,
                                              fontFamily =  main_font,
                                              fontWeight = regular_font_weight,
                                              fontSize='14px')),
                     xAxis=list(title=list(enabled=FALSE),
                                labels=list(style=list(color=black,
                                                  fontFamily = main_font, 
                                                  fontWeight = regular_font_weight,
                                                  fontSize="14px"))),
                     yAxis=list(title=list(enabled=FALSE),
                                labels=list(style=list(color=black,
                                                  fontFamily= main_font, # font_axis_label
                                                  fontWeight = regular_font_weight,
                                                  fontSize="14px")),
                                visible = F, 
                                startOnTick = F, 
                                endOnTick = F))

```


```{r data-prep, include=FALSE}

# This Creates the data-frame for the Support & Revenue Barchart

support <- c("Contributions", "Contracts", "Grants", "Other Income")
revenue <- c(2359843, 1779856, 9018627, 66838)

df <- data.frame(support, revenue) %>%
  mutate(percentage=paste0(round(revenue/sum(revenue)*100, 1), "%"),
         revenue_label = paste0("$", prettyNum(revenue, big.mark = ",", scientific = FALSE))) %>%
  arrange(desc(revenue))

# Total Support & Revenue: $13,225,164

```

```{r, echo=FALSE,out.width="100%", out.height="100%"}
support_category_colors <- c(meteorite, "#991F7B", "#D8406A", "#FC7957")

# Bar Chart for Support and Revenue 
hchart(df,
       type = "bar",
       hcaes(x=support, y=revenue, color=support_category_colors),
       dataLabels = list(enabled = TRUE,
                         format = '{point.revenue_label}',
                         style = list(fontFamily = main_font, # font_subtitle
                          fontWeight = black_font_weight,
                          fontSize='14px'))) %>%
  hc_tooltip(headerFormat= "",
             style = list(color = black,
                          fontFamily = main_font, # font_subtitle
                          fontWeight = black_font_weight,
                          fontSize='16px'), # size of labels
             pointFormat = "{point.percentage:.1f}") %>%
  
  hc_yAxis(min = 0,
           max = 9200000) %>%

  hc_title(text = "Statement of Activities") %>%

  hc_subtitle(text = "Support and Revenue") %>%

  hc_caption(text = "Total Support & Revenue: $13,225,164") %>%
  
  hc_add_theme(eoy_theme)  %>% 

  hc_size(height=480)

```

<script>
  widg = document.getElementsByClassName('html-widget'); //find widgets
  for (let i = 0; i < widg.length; i++) { //loop through
    document.getElementsByClassName('highchart')[i].style.width = '100%'; //adjust width
    document.getElementsByClassName('highchart')[i].style.height = '100%'; //adjust height
  }
</script>
